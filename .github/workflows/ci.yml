name: Test Reporter Demo

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  test-reporter-demo:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Create proper sample TRX file
        run: |
          mkdir -p TestResults
          # Create a properly formatted TRX file
          cat > TestResults/sample.trx << 'EOF'
          <?xml version="1.0" encoding="UTF-8"?>
          <TestRun xmlns="http://microsoft.com/schemas/VisualStudio/TeamTest/2010">
            <TestDefinitions>
              <UnitTest name="Test1" storage="test1.dll">
                <TestMethod className="TestClass1" name="Test1"/>
              </UnitTest>
              <UnitTest name="Test2" storage="test1.dll">
                <TestMethod className="TestClass1" name="Test2"/>
              </UnitTest>
              <UnitTest name="Test3" storage="test1.dll">
                <TestMethod className="TestClass1" name="Test3"/>
              </UnitTest>
            </TestDefinitions>
            <Results>
              <UnitTestResult testName="Test1" outcome="Passed" duration="00:00:01.000"/>
              <UnitTestResult testName="Test2" outcome="Failed" duration="00:00:02.000">
                <Output>
                  <ErrorInfo>
                    <Message>Test failed message</Message>
                    <StackTrace>at TestClass1.Test2()</StackTrace>
                  </ErrorInfo>
                </Output>
              </UnitTestResult>
              <UnitTestResult testName="Test3" outcome="Passed" duration="00:00:01.500"/>
            </Results>
            <ResultSummary outcome="Completed">
              <Counters total="3" executed="3" passed="2" failed="1" error="0" timeout="0" aborted="0" inconclusive="0" passedButRunAborted="0" notRunnable="0" notExecuted="0" disconnected="0" warning="0" completed="0" inProgress="0" pending="0"/>
            </ResultSummary>
          </TestRun>
          EOF

      - name: Generate test summary with dorny/test-reporter
        uses: dorny/test-reporter@v1.9.1
        with:
          name: Test Summary Report
          path: "TestResults/*.trx"
          reporter: dotnet-trx
          fail-on-error: false
          list-tests: 'failed'
          only-summary: false