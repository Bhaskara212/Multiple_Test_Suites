name: Tests with Multiple Suites

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run Unit Tests
      run: npm run test:unit -- --reporter=junit --reporter-option=output=unit-test-results.xml
      continue-on-error: true  # Continue even if unit tests fail
    
    - name: Run Integration Tests
      run: npm run test:integration -- --reporter=junit --reporter-option=output=integration-test-results.xml
      continue-on-error: true  # Continue even if integration tests fail
    
    - name: Run E2E Tests
      run: npm run test:e2e -- --reporter=junit --reporter-option=output=e2e-test-results.xml
      continue-on-error: true  # Continue even if E2E tests fail
    
    - name: Publish Test Reports
      uses: dorny/test-reporter@v1
      if: always()  # Always run even if tests fail
      with:
        name: All Test Results
        path: |
          unit-test-results.xml
          integration-test-results.xml
          e2e-test-results.xml
        reporter: jest-junit
        fail-on-error: false  # Don't fail the workflow on test failures
        show-summary: true
        show-tests: failed  # Only show failed tests in summary